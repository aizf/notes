---
title: js作用域和作用域链
tags:
    - js
---

## 1 作用域(Scope)

作用域是在运行时代码中的某些特定部分中变量，函数和对象的可访问性。换句话说，**作用域决定了代码区块中变量和其他资源的可见性**。

ES6 之前 JavaScript 没有块级作用域,只有全局作用域和函数作用域。ES6 的到来，为我们提供了‘块级作用域’,可通过新增命令 let 和 const 来体现。

### 1.1 全局作用域和函数作用域

在代码中任何地方都能访问到的对象拥有全局作用域

一般情况下，window 对象的内置属性都拥有全局作用域，例如 window.name、window.location、window.top 等等。

作用域是分层的，内层作用域可以访问外层作用域的变量，反之则不行。

### 1.2 块级作用域

块级作用域在如下情况被创建：

1. 在一个函数内部
2. 在一个代码块（由一对花括号包裹）内部

暂时性死区

## 2 作用域链

### 2.1 自由变量

首先认识一下什么叫做 自由变量 。如下代码中，`console.log(a)`要得到 `a` 变量，但是在当前的作用域中没有定义 `a`（可对比一下 `b`）。当前作用域没有定义的变量，这成为 自由变量。

```js
var a = 100
function fn() {
    var b = 200
    console.log(a) // 这里的a在这里就是一个自由变量
    console.log(b)
}
fn()
```

### 2.2 什么是作用域链

如果父级也没呢？再一层一层向上寻找，直到找到全局作用域还是没找到，就宣布放弃。这种一层一层的关系，就是 作用域链 。

### 2.3 关于自由变量的取值

```js
var x = 10
function fn() {
  console.log(x)
}
function show(f) {
  var x = 20
  (function() {
    f()
  })()
}
show(fn)    //10，而不是20
```

在 `fn` 函数中，取自由变量 `x` 的值时，要到哪个作用域中取？——**要到创建 `fn` 函数的那个作用域中取，无论 `fn` 函数将在哪里调用**。

这就是所谓的"**静态作用域**"

## 3 作用域与执行上下文

JavaScript 属于解释型语言，JavaScript 的执行分为：**解释**和**执行**两个阶段,这两个阶段所做的事并不一样

解释阶段：

- 词法分析
- 语法分析
- 作用域规则确定

执行阶段：

- 创建执行上下文(比如`this`)
- 执行函数代码
- 垃圾回收

## 有三种语句可以加强作用域链：try catch；with；eval

`trycatch`中的`catch`和`with`语句都会在作用域链的前端添加一个变量对象。

对`with`语句来说，将指定的对象添加到作用域链中

对`catch`语句来说，会创建一个新的变量对象，其中包含的是被抛出的错误对象的声明

而`eval`由于可以被赋值给变量，在被赋值的时候会将`eval`所处的变量作用域也赋值过去，所以可以使得作用域获得扩展。

eg:

```js
let a=0;
try{
    throw new Error("error")
}catch(e){
    console.log(a); //undefined
}
```

```js
var x=1,evalg=eval;

function a(){

　　var x=3;

　　eval("alert(x)");   //3

　　evalg("alert(x)");  //1

}
```
