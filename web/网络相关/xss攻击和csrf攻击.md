#

## 1 CSRF（Cross-site request forgery）：跨站请求伪造

原理：转发Cookie

### 1.1 如何防御

#### 方法一：Token 验证：（用的最多）

（1）服务器发送给客户端一个token；

（2）客户端提交的表单中带着这个token。

（3）如果这个 token 不合法，那么服务器拒绝这个请求。

#### 方法二：隐藏令牌：

把 token 隐藏在 http 的 head头中。

方法二和方法一有点像，本质上没有太大区别，只是使用方式上有区别。

#### 方法三：Referer 验证(SameSite属性)：

Referer 指的是页面请求来源。意思是，只接受本站的请求，服务器才做响应；如果不是，就拦截

## 2 XSS（Cross Site Scripting）：跨域脚本攻击

### 2.1 XSS的攻击原理

不需要你做任何的登录认证，它会通过合法的操作（比如在url中输入、在评论框中输入），向你的页面**注入脚本**（可能是js、hmtl代码块等）。

最后导致的结果可能是：

盗用Cookie破坏页面的正常结构，插入广告等恶意内容D-doss攻击

### 2.2 XSS的攻击方式

#### 1、反射型

发出请求时，**XSS代码出现在url中，作为输入提交到服务器端，服务器端解析后响应，XSS代码随响应内容一起传回给浏览器，最后浏览器解析执行XSS代码**。这个过程像一次反射，所以叫反射型XSS。

#### 2、存储型

储型XSS和反射型XSS的差别在于，提交的代码**会存储在服务器端**（数据库、内存、文件系统等），下次请求时目标页面时不用再提交XSS代码。

XSS的防范措施（encode + 过滤）

### 2.3 XSS的防范措施主要有三个

1、对敏感字符做转义

(1) HTML：对以下这些字符进行转义：

- `&：&amp;`
- `<：&alt;`
- `>：&gt;`
- `'：&#x27;`
- `"：&quot;`
- `/：&#x2F;`

(2) Javascript：把所有非字母、数字的字符都转义成小于256的ASCII字符；
(3)URL：使用Javascript的`encodeURIComponent()`方法对用户的输入进行编码，该方法会编码如下字符：`,      /      ?     :     @     &     =     +     $     #`

2、过滤诸如`<script>`、`<img>`、`<a>` 标签

3、CSP

本质上是建立白名单，规定了浏览器只能够执行特定来源的代码，在网站的http头部定义了 `Content-Security-Policy`

4、Http响应头设置HttpOnly

cookie中设置了HttpOnly属性，那么通过js脚本将无法读取到cookie信息
